Delivered-To: takakusa.yasuo@rene-easton.com
Received: by 10.194.137.78 with SMTP id qg14csp453684wjb;
        Tue, 3 Mar 2015 01:00:50 -0800 (PST)
X-Received: by 10.68.237.165 with SMTP id vd5mr54978192pbc.44.1425373248846;
        Tue, 03 Mar 2015 01:00:48 -0800 (PST)
Return-Path: <kazuhiko_iwata@clarion.co.jp>
Received: from mail9.hitachi.co.jp (mail9.hitachi.co.jp. [133.145.228.44])
        by mx.google.com with ESMTP id ej13si305719pdb.37.2015.03.03.01.00.47;
        Tue, 03 Mar 2015 01:00:48 -0800 (PST)
Received-SPF: none (google.com: kazuhiko_iwata@clarion.co.jp does not designate permitted sender hosts) client-ip=133.145.228.44;
Authentication-Results: mx.google.com;
       spf=none (google.com: kazuhiko_iwata@clarion.co.jp does not designate permitted sender hosts) smtp.mail=kazuhiko_iwata@clarion.co.jp
Received: from mlsv8.hitachi.co.jp (unknown [133.144.234.166])
	by mail9.hitachi.co.jp (Postfix) with ESMTP id A9FE837C87;
	Tue,  3 Mar 2015 18:00:46 +0900 (JST)
Received: from mfilter05.hitachi.co.jp by mlsv8.hitachi.co.jp (8.13.1/8.13.1) id t2390k6l026829; Tue, 3 Mar 2015 18:00:46 +0900
Received: from vshuts02.hitachi.co.jp (vshuts02.hitachi.co.jp [10.201.6.84])
	by mfilter05.hitachi.co.jp (Switch-3.3.4/Switch-3.3.4) with ESMTP id t2390gNw028811;
	Tue, 3 Mar 2015 18:00:46 +0900
Received: from gateway.clarion.co.jp (unknown [192.168.72.21])
	by vshuts02.hitachi.co.jp (Postfix) with ESMTP id 9F542490042;
	Tue,  3 Mar 2015 18:00:45 +0900 (JST)
Received: from SV0804-40037.ct.clarion (smtp.clarion.co.jp [192.168.72.32])
	by gateway.clarion.co.jp (Postfix) with ESMTP id 90804CA844F;
	Tue,  3 Mar 2015 18:00:45 +0900 (JST)
Received: from mail1.clarion.co.jp (ldap.clarion.co.jp [192.168.72.5])
	by SV0804-40037.ct.clarion (Switch-3.3.2/Switch-3.3.2) with ESMTP id t2390h5l023158;
	Tue, 3 Mar 2015 18:00:44 +0900
Received: from [127.0.0.1] ([10.240.80.136])
	by mail1.clarion.co.jp (8.13.1/8.13.1) with ESMTP id t2390gEx028667;
	Tue, 3 Mar 2015 18:00:43 +0900
Message-ID: <54F57839.1090804@clarion.co.jp>
Date: Tue, 03 Mar 2015 18:00:41 +0900
From: iwata_kazuhiko <kazuhiko_iwata@clarion.co.jp>
User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:31.0) Gecko/20100101 Thunderbird/31.5.0
MIME-Version: 1.0
To: =?UTF-8?B?IltBREFDXeW3peiXpOanmCI=?= <kudo@adac.co.jp>,
	=?UTF-8?B?IltBREFDXem5v+mHjuanmCI=?= <keino@adac.co.jp>,
	=?UTF-8?B?IltBRA==?= =?UTF-8?B?QUNd5Y2X44CA5qeYIg==?= <minami@adac.co.jp>,
	=?UTF-8?B?Ilvjg6vjg40=?= =?UTF-8?B?44K144K544Kk44O844K544OI44OzXeiXpOW3u+anmCI=?= <fujimaki.toshihide@rene-easton.com>,
	=?UTF-8?B?Ilvjg6vjg43jgrXjgrnjgqTjg7w=?= =?UTF-8?B?44K544OI44OzXeWuieWuheanmCI=?= <atagi.masashi@rene-easton.com>,
	=?UTF-8?B?Ilvjg6vjg43jgrXjgrnjgqTjg7zjgrnjg4jjg7NdJ+mrmOiNieOAgOazsOeUnyc=?= =?UTF-8?B?5qeYIg==?= <takakusa.yasuo@rene-easton.com>,
	=?UTF-8?B?Ilvjg6vjg40=?= =?UTF-8?B?44K144K544Kk44O844K544OI44OzXeS8j+imi+anmCAi?= <fushimi.atsushi@rene-easton.com>,
	=?UTF-8?B?Ilvjg6vjg43jgrXjgrld5pif5qeY?= =?UTF-8?B?44CAIg==?= <yasuhiko.hoshi.ct@renesas.com>,
	"ML-RCV2H-PF-Soft@clarion.co.jp" <ML-RCV2H-PF-Soft@clarion.co.jp>
Subject: =?UTF-8?B?W1JDVjJIXUlP44OH44OQ44Kk44K555S75YOP6KqN6K2Y6auY6YCf5YyW?=
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 8bit

ルネサスイーストン　高草様　藤巻様
cc:ルネサス　星様　　
　　Adac　工藤様　　慶野様

いつもお世話になります。
クラリオン　岩田です。

現在の開発状況ですが　機能実装が80%程度まで進みました。
しかしながら　処理負荷が重く、パフォーマンスが出せていない状況です。
それに伴う不具合が多数発生しております。

原因は大きく２つあり一つはIOデバイスによるレジスタアクセス
時間や割り込み待ちなどのハード処理時間が長い問題。
もう一つは画像認識処理の処理時間が長い問題です。

この２つの問題を至急解決しないと今後の開発が困難な状況です。
そこで課題を分担し定期的に課題解決の共同デバックを開催します。
ルネサス様、イーストン様、ADAC様　ご協力をお願いします。

下記はIOデバイスに関する問題点一覧です。
窓口は吉岡が担いますので日程調整をお願いします。


「パフォーマンス改善依頼リスト」

目的：とにかくふれこみ（期待）どおりの性能を出したい。
基本構想：RCarV2HのコアであるARMの速度を犠牲にしないドライバ構成と
      すること
背景：最近画像認識の機能が増えて動作するようになり、
　　　それとともにシステム動作パフォーマンスが落ちてきた
　　　画像認識のアプリケーションは低優先度で影響しないはずだが
　　　使用しているドライバ関連の悪影響だと考えられる。
　　　画像認識関連にかかわらず、表示も含めこの機会に改善を実施する。

改善項目：
・OS機構のCallback先/IODevice/InterruptHandlerの動作では最小限の処理時間 
とすること
・Driverで生成するTaskの動作では最小限の処理時間とすること
・CPUペリフェラルの待ち合わせを、そのものだけが終了条件のソフトループで
　実施しないこと。その間、他が動作できるようにしたい。それができないなら
　せめて無限ループの可能性をなくしたい。
・CPU動作速度に比べレジスタアクセスが低速であり、工夫が必要
・usleepでの待ち合わせ時間の調査推進：川上氏確認中:[ADaC][QA表No.094]
・毎回レジスタアクセス毎にIODeviceをコールしているのでは、
　IODeviceの処理時間に依存してパフォーマンスが出せない。
　(レジスタアクセスの処理だけで数usec掛かってしまう)
　連続してレジスタ制御があるような処理はKernel側でまとめて処理すること。
　(処理時間、処理効率を見てチューニングが必要。)
・レジスタアクセスの理論値はリード、ライト共に
　Peripheral Bus Clock 6cyc分と伺っているが実測では、
　それよりも遅い結果となっている。
　最低限、これに近い値になるようレジスタ設定の見直し等、
　バスのチューニングが必要。
・先ずは、実際の処理時間、処理頻度が定量的に提示できること。
・OSのパフォーマンス検証結果の可視化
・ソフト構成、・起動、・スケジューリング処理、・割込処理、・エラー処 
理、・システム監視の項目で、RTOSに関する検証を行う
・kernel_opt(リリース版デバッグ不可),kernel_checked(深デバッグ版内部エ 
ラー表示)の利用ができない件の解決
・割り込み処理一覧と、その割り込み処理時間の最大値を確認する
・割り込み禁止命令実装一覧と割り込み禁止時間の最大値を確認する

現状見えている問題：
・割り込み遅延が発生している
　⇒割り込み頻度が高い、割り込み処理時間が長いISRがある。
・意図せずCallback/IODeviceで異常に長い時間待たされることがある。
　⇒Callback/IODeviceの頻度が高い、処理時間が長い処理がある。
・レジスタのアクセス時間が遅い
　⇒バス設定のチューニングができていない。
　　もしくは、そもそもハード仕様なのであれば、
　　それを仕様として提示して頂きたい。

ゴール：
ドライバごとにISR/IODevice/Callback/Taskの動作頻度および処理時間目標を設 
定し、
測定・評価することでシステムへの影響度合いを確認する
CPU負荷率　70%以下程度とする。　


以上　よろしくお願いします。

-- 
*************************************************
クラリオン株式会社
インテリジェント・セーフティ事業推進本部
インテリジェント・セーフティ・システム開発部
アプリケーションG
岩田  和彦
E-MAIL: Kazuhiko_Iwata@clarion.co.jp
ADDRESS:〒330-0081埼玉県さいたま市中央区新都心7-2
ダイヤルイン:048-601-4532  (20541)
FAX:048-601-1702
http://www.clarion.com/jp
*************************************************
快適・安心・便利なドライブをお楽しみ頂くための、
クラリオンの情報ネットワークサービス
「Smart Access」http://www.smart-acs.com
*************************************************


